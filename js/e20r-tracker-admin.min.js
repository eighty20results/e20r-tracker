console.log("Loading back-end javascript script for e20r-tracker");jQuery.noConflict();jQuery(document).ready(function($){console.log("WP-Admin script for E20R Tracker loaded");var $clientIdSelect=$("#e20r_tracker_client");var $levelIdSelect=$("#e20r_levels");var $oldClientId=$clientIdSelect.find("option:selected").val();var $detailBtn=$("#e20r-client-info");var $complianceBtn=$("#e20r-client-compliance");var $assignBtn=$("#e20r-client-assignments");var $measureBtn=$("#e20r-client-measurements");var $loadBtn=$("#e20r-load-data");var $loadItem=$("#e20r-load-action-items");var $spinner=$("#e20r-postmeta-setprogram").find("e20r_spinner");$(document).on("click","#e20r-new-group-button",function(){$.ajax({url:ajaxurl,type:"POST",timeout:e20r_tracer.timeout,dataType:"JSON",data:{action:"e20r_addWorkoutGroup","e20r-tracker-workout-settings-nonce":$("#e20r-tracker-workout-settings-nonce").val(),post_ID:$("#post_ID").val()},error:function($response,$errString,$errType){console.log("From server: ",$response);console.log("Error String: "+$errString+" and errorType: "+$errType+" from e20r_addWorkoutGroup()");var $msg="";if("timeout"===$errString){$msg="Error: Timeout while the server was processing data.\n\n"}var $string;$string="An error occurred while trying to add a Workout Group to this page. If you'd like to try again, please ";$string+="click 'Save', then force a reload of this page and try again. \n\nShould you get this error a second time, ";$string+="please contact Technical Support by using the Contact form ";$string+="at the top of this page. When you contact Technical Support, please include this entire message.";alert($msg+$string+"\n\n"+$response.data)},success:function($retVal){console.log("Group data being added",$retVal);if($retVal.data.groupHtml!==""){jQuery("#e20r-workout-tbody").append($retVal.data.groupHtml)}},complete:function(){}})});$(document).on("click",".e20r-remove-group",function(){var $header=$(this).closest("tr");var $data=$header.next("tr");$header.remove();$data.remove();return false});$(document).on("click",".e20r-exercise-remove",function(){var $exLine=$(this).closest("tr");$exLine.remove()});$(document).on("click",".e20r-workout-save-exercise",function(){var $exerciseList=$(this).closest(".e20r-exercise-list").find("tbody");var $tFooter=$(this).closest(".e20r-exercise-list").find("tfoot");var $groupId=$tFooter.find("input[id*='e20r-workout-group_id-']").val();var $exDef=$tFooter.find("select[class*='e20r-workout-group-exercise']");var $exReps=$tFooter.find("input[id*='e20r-workout-add-exercise-reps']");var $exRest=$tFooter.find("input[id*='e20r-workout-add-exercise-rest']");var $exType=$tFooter.find("select[id*='e20r-workout-add-exercise-type']");var $data={action:"addExerciseToGroup","e20r-tracker-workout-settings-nonce":$("#e20r-tracker-workout-settings-nonce").val(),post_ID:$("#post_ID").val(),group_id:$groupId,"exercise-id":$exDef.find("option:selected").val(),"exercise-type":$exType.find("option:selected").val(),"exercise-reps":$exReps.val(),"exercise-rest":$exRest.val()};console.log("Action data: ",$data);$exerciseList.find("tr").each(function(){if(this.length==1){this.remove()}})});$(document).on("change","#e20r_tracker_client",function(){console.log("Client to find changed");saveClientId($oldClientId)});$(document).on("click","#e20r-load-action-items",function(){$loadItem.prop("disabled",true);jQuery("#spin-for-action-item").show();loadCheckinItem($("#e20r_checkin_items").find("option:selected").val());jQuery("#spin-for-action-item").show();$loadItem.prop("disabled",false)});$(document).on("click","#e20r-client-compliance",function(){e20r_LoadClientData("compliance");saveClientId($oldClientId)});$(document).on("click","#e20r-client-assignments",function(){e20r_LoadClientData("assignments");saveClientId($oldClientId)});$(document).on("focus","textarea.expand",function(){$(this).animate({height:"10em",width:"400px"},500)});$(document).on("focusout","textarea.expand",function(){$(this).animate({height:"28px",width:"250px"},500)});$(document).on("click",".e20r-faq-question",function(){console.log("Configure event(s) for the Activity container");$("button.e20r-workout-statistics-loader").each(function(){var $loadBtn=jQuery(this);jQuery.bindEvents({self:progMeasurements,elem:$loadBtn,events:{click:function(self,e){console.log("Loading statistics for exercise",this);var $exercise_id=$loadBtn.closest(".e20r-exercise-statistics").find(".e20r-workout-statistics-exercise_id").val();var $client_id=jQuery("#user_id").val();var $graph=$loadBtn.closest(".e20r-exercise-statistics").find("div#exercise_stats_"+$exercise_id);console.log("Exercise Id: "+$exercise_id+" and client id: "+$client_id,$graph);progMeasurements.loadActivityStats($client_id,$exercise_id,$graph)}}})});console.log("Opening activity info in back-end");var $this_heading=$(this);var $module=$this_heading.closest(".e20r-faq-container");var $content=$module.find(".e20r-faq-answer-container");if($content.is(":animated")){return}$content.slideToggle(700,function(){if($module.hasClass("e20r-toggle-close")){$module.removeClass("e20r-toggle-close").addClass("e20r-toggle-open")}else{$module.removeClass("e20r-toggle-open").addClass("e20r-toggle-close")}})});$(document).on("click","#e20r-add-new-item",function(){$(".add-new").hide();$("#add-new-action-item").show()});$(document).on("change",".new-e20rprogram-select",function(){e20rPgm_postMetaSelectChanged(this)});$(document).on("click","#e20r-tracker-new-meta",function(){e20rPgm_lockMetaRows();$spinner.show();e20rPgm_rowVisibility(jQuery(".new-e20rprogram-select"),"select");$spinner.hide();e20rPgm_unlockMetaRows()});$(document).on("click","#e20r-tracker-new-meta-reset",function(){e20rPgm_lockMetaRows();$spinner.show();e20rPgm_showMetaControls();$spinner.hide();e20rPgm_unlockMetaRows()})});